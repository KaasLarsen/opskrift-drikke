<!doctype html>
<html lang="da">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Guides – opskrift-drikke.dk</title>

    <!-- Tailwind -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com"/>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Meta -->
    <meta name="description" content="Find inspiration og viden i vores guides om kaffe, te, smoothies, mocktails og meget mere."/>
    <meta property="og:title" content="Guides – opskrift-drikke.dk"/>
    <meta property="og:description" content="Læs vores bedste guides om drikke, maskiner og udstyr."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://www.opskrift-drikke.dk/pages/guides"/>

    <link rel="icon" href="/assets/favicon.svg" type="image/svg+xml">
    <link rel="manifest" href="/assets/manifest.json">
    <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml"/>

    <!-- Global scripts -->
    <script type="module" src="/js/app.js"></script>
    <script defer src="/js/analytics.js"></script>

    <style>
      .card { border-radius: 1rem; box-shadow: 0 4px 18px rgba(0,0,0,.06); }
      .btn { border-radius: 1rem; }

      .search-box {
        background: #fff7f2;
        border: 1px solid #fed7aa;
        border-radius: 1rem;
        padding: 0.5rem 0.75rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        transition: box-shadow .2s ease;
      }
      .search-box:focus-within {
        box-shadow: 0 0 0 3px rgba(249,115,22,.2);
      }
      .search-box input {
        background: transparent;
        border: none;
        outline: none;
        width: 100%;
        color: #1c1917;
      }
      .search-box svg {
        color: #f97316;
      }

      .tag {
        background: #f4f4f4;
        border-radius: 9999px;
        padding: 0.25rem 0.75rem;
        font-size: 0.875rem;
        cursor: pointer;
        transition: background .2s ease;
      }
      .tag:hover { background: #ffe8d9; }
      .tag.active { background: #f97316; color: #fff; }
    </style>
  </head>

  <body class="bg-stone-50 text-stone-900">
    <div id="header"></div>

    <main class="max-w-6xl mx-auto px-4 py-8">
      <h1 class="text-3xl font-semibold mb-4">Guides</h1>
      <p class="opacity-80 mb-6">Find trin-for-trin guides om kaffe, te, smoothies, mocktails, juice, udstyr og meget mere.</p>

      <!-- søgefelt -->
      <div class="max-w-md mb-6">
        <div class="search-box">
          <svg class="w-5 h-5"><use href="/assets/icons.svg#search"/></svg>
          <input type="search" id="guideSearch" placeholder="Søg i guides..." />
        </div>
      </div>

      <!-- tags / kategorier -->
      <div id="guideTags" class="flex flex-wrap gap-2 mb-8"></div>

      <!-- liste -->
      <div id="guideList" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </main>

    <div id="footer"></div>

    <script type="module">
  const listEl  = document.getElementById('guideList');
  const searchEl= document.getElementById('guideSearch');
  const tagWrap = document.getElementById('guideTags');

  const V = 'guides-v1'; // bump hvis du uploader nye data (cache-bust)
  const j = (p) => fetch(`${p}?${V}`, { cache:'no-cache' }).then(r => r.ok ? r.json() : []);

  let guides = [];
  let activeTag = '';

  async function loadGuides(){
    // 1) prøv chunkede filer
    let all = [];
    try {
      const first = await j('/data/guides-1.json');
      if (Array.isArray(first) && first.length){
        all = all.concat(first);
        for (let i=2;i<=20;i++){
          try {
            const arr = await j(`/data/guides-${i}.json`);
            if (!Array.isArray(arr) || !arr.length) break;
            all = all.concat(arr);
          } catch { break; }
        }
      }
    } catch {}

    // 2) fallback til samlet fil, hvis ingen chunks
    if (!all.length){
      try { all = await j('/data/guides.json'); }
      catch (e){
        listEl.innerHTML = '<p class="opacity-70">Kunne ikke indlæse guides.</p>';
        console.error(e);
        return;
      }
    }

    guides = all;
    renderGuides(guides);
    renderTags();
    // pæn placeholder
    if (searchEl) searchEl.placeholder = `Søg i ${guides.length.toLocaleString('da-DK')} guides...`;
  }

  function renderGuides(list){
    if(!list.length){
      listEl.innerHTML = '<p class="opacity-70">Ingen guides fundet.</p>';
      return;
    }
    listEl.innerHTML = list.map(g => `
      <a href="/pages/guide.html?slug=${g.slug}" class="block card bg-white p-5 hover:shadow-md transition">
        <h2 class="font-semibold text-lg mb-2">${g.title}</h2>
        <p class="text-sm opacity-80">${g.intro || ''}</p>
        <div class="text-xs opacity-60 mt-3">${g.category || ''}</div>
      </a>
    `).join('');
  }

  function renderTags(){
    const tagSet = new Set();
    guides.forEach(g => (g.tags||[]).forEach(t => tagSet.add(t)));
    const tags = Array.from(tagSet).sort((a,b)=>a.localeCompare(b,'da'));
    tagWrap.innerHTML = tags.map(t => `
      <span class="tag ${t === activeTag ? 'active' : ''}" data-tag="${t}">${t}</span>
    `).join('');
  }

  function applyFilters(){
    const q = (searchEl.value || '').toLowerCase().trim();
    const filtered = guides.filter(g => {
      const title = (g.title||'').toLowerCase();
      const intro = (g.intro||'').toLowerCase();
      const matchText = title.includes(q) || intro.includes(q);
      const matchTag = !activeTag || (g.tags||[]).some(t => (t||'').toLowerCase() === activeTag.toLowerCase());
      return matchText && matchTag;
    });
    renderGuides(filtered);
  }

  searchEl.addEventListener('input', applyFilters);
  tagWrap.addEventListener('click', e => {
    const tag = e.target.closest('[data-tag]');
    if(!tag) return;
    activeTag = (activeTag.toLowerCase() === tag.dataset.tag.toLowerCase()) ? '' : tag.dataset.tag;
    renderTags();
    applyFilters();
  });

  loadGuides();
</script>
  </body>
</html>
